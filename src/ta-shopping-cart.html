<link rel="import" href="../bower_components/polymer/polymer.html">

<link rel="import" href="../bower_components/iron-media-query/iron-media-query.html">

<link rel="import" href="../bower_components/paper-button/paper-button.html">

<link rel="import" href="ta-cart.html">
<link rel="import" href="cart/my-cart-item.html">
<link rel="import" href="cart/my-cart-table/my-cart-table.html">
<link rel="import" href="filters/filter-currency.html">

<dom-module id="ta-shopping-cart">
  <template>
    <style>
       :host {
        --ta-shopping-cart-padding: 16px;
        max-width: 1280px;
        margin-left: auto;
        margin-right: auto;
        display: block;
        padding: calc(var(--ta-shopping-cart-padding)/2);
      }

      my-cart-item {
        margin-bottom: calc(var(--ta-shopping-cart-padding)/2);
      }

      #checkout {
        display: block;
        color: #fff;
        background: var(--paper-red-500);
        box-shadow: 0 3px 4px 0 rgba(0, 0, 0, 0.14), 0 1px 8px 0 rgba(0, 0, 0, 0.12), 0 3px 3px -2px rgba(0, 0, 0, 0.4);
        border-radius: 3px;
        line-height: 1.5;
      }

      #checkout[hidden],
      my-cart-table[hidden] {
        display: none;
        pointer-events: none;
      }

      #gocheckout,
      #total {
        text-align: center;
      }

      #gocheckout {
        font-size: 18px;
        padding: 13px;
      }

      #total {
        font-size: 20px;
        padding: 0px 13px 13px 13px;
      }

      #empty {
        text-align: center;
        font-size: 24px;
        font-weight: normal;
      }

      @media all and (max-width: 600px) {
        #cartTable {
          display: none;
        }
      }

      @media all and (min-width: 601px) {
        my-cart-item,
        #checkout {
          display: none;
        }
      }
    </style>
    <firebase-auth id="auth" user="{{user}}"></firebase-auth>
    <firebase-query id="cart" path="/cart/pending/[[user.uid]]" data="{{cart}}"></firebase-query>

    <ta-cart total="{{cartTotal}}"></ta-cart>

    <filter-currency id="filterCurrency" zero-value="Â£0.00"></filter-currency>

    <iron-media-query query="min-width: 600px" query-matches="{{largeScreen}}"></iron-media-query>

    <h2 id="empty" hidden="[[cartTotal]]">cart is empty</h2>

    <!-- <template is="dom-if" if="[[!largeScreen]]"> -->
    <template id="cartrepeater" is="dom-repeat" items="[[cart]]">
      <my-cart-item item-key="[[item.$key]]"></my-cart-item>
    </template>

    <div id="checkout" class="card-content" on-tap="_checkoutTap" hidden="[[!cartTotal]]">
      <div id="gocheckout">Checkout - Total: [[_priceFilter(cartTotal)]]</div>
    </div>
    <!-- </template> -->

    <my-cart-table id="cartTable" hidden="[[!cartTotal]]"></my-cart-table>


  </template>
  <script>
    Polymer({

      is: 'ta-shopping-cart',

      properties: {

      },

      _checkoutTap: function() {
        this.fire('checkout-tapped');
      },

      _priceFilter: function(price) {
        return this.$.filterCurrency.filter(price);
      },
    });
  </script>
</dom-module>
